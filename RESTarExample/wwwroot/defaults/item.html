<link rel="import" href="/sys/polymer/polymer.html">
<link rel="import" href="/sys/puppet-redirect/puppet-redirect.html"/>
<link rel="import" href="/sys/paper-alert-dialog/paper-alert-dialog.html"/>

<template>
    <template is="dom-bind">
        <h3>
            <a href="{{model.ResourcePath}}">{{model.ResourceName}}</a>
        </h3>
       
        <template is="dom-repeat" items="{{model.Members$}}"as="member">
            <RESTar-default member="{{member}}"></RESTar-default>
        </template>

        <br/>
        <div>
            <button class="btn btn-sm btn-primary" value="{{model.Save$::click}}" on onmouseup="++this.value">Save</button>
            <button class="btn btn-sm btn-default" value="{{model.Close$::click}}" on onmouseup="++this.value">Close</button>
        </div>
        <link is="puppet-redirect" history url$="{{model.RedirectUrl$}}"/>
        <br/>
    </template>
</template>

<dom-module is="RESTar-default">
    <template>
        <template is="dom-if" if="{{_bool(member)}}">
            <label>{{member.Name$}}<input type="checkbox" checked="{{member.Value$::change}}"/></label>
        </template>
        <template is="dom-if" if="{{_arr(member)}}">
            <label>{{member.Name$}}<input type="text" value="{{member.Value$::input}}"/></label>
        </template>
        <template is="dom-if" if="{{_obj(member)}}">
            <label>{{member.Name$}}<input type="text" checked="{{member.Value$::input}}"/></label>
        </template>
        <template is="dom-if" if="{{_num(member)}}">
            <label>{{member.Name$}}<input type="number" value="{{member.Value$::input}}"/></label>
        </template>
        <template is="dom-if" if="{{_str(member)}}">
            <label>{{member.Name$}}<input type="text" value="{{member.Value$::input}}"/></label>
        </template>
        <br/>
    </template>
    <script>
        Polymer({
            is: "RESTar-default",
            properties: {
                member: Object
            },
            _bool: member => member.Type === "boolean",
            _arr: member => member.Type === "array",
            _obj: member => member.Type === "object",
            _num: member => member.Type === "number",
            _str: member => member.Type === "string"
        });
    </script>
</dom-module>

<dom-module is="RESTar-alldefault">
    <template>
        <template is="dom-repeat" items="{{_members(entity)}}" as="member">
            <template is="dom-if" if="{{_bool(member)}}">
                <label>{{member.name}}<input type="checkbox" checked="{{member.value::change}}"/></label>
            </template>
            <template is="dom-if" if="{{_arr(member)}}">
                <label>{{member.name}}<input type="text" value="{{member.value::input}}"/></label>
            </template>
            <template is="dom-if" if="{{_obj(member)}}">
                <label>{{member.name}}<input type="text" checked="{{member.value::input}}"/></label>
            </template>
            <template is="dom-if" if="{{_num(member)}}">
                <label>{{member.name}}<input type="number" value="{{member.value::input}}"/></label>
            </template>
            <template is="dom-if" if="{{_str(member)}}">
                <label>{{member.name}}<input type="text" value="{{member.value::input}}"/></label>
            </template>
            <br/>
        </template>

    </template>
    <script>
        _getType = o => Array.isArray(o) ? "array" : typeof(o);
        Polymer({
            is: "RESTar-alldefault",
            properties: {
                entity: Object
            },
            _bool: member => member.type === "boolean",
            _arr: member => member.type === "array",
            _obj: member => member.type === "object",
            _num: member => member.type === "number",
            _str: member => member.type === "string",
            _members: obj => Object.keys(obj).map(key => ({
                name: key.slice(0, -1),
                value: obj[key],
                type: _getType(obj[key])
            }))
        });
    </script>
</dom-module>